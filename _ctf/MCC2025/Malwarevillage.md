# MCC Village Night Malware Writeup

This writeup is for those who didnt get the opportunity to try the malware village.

---

There are multiple ways to solve this challenges, personally i would use virustotal for convenience but OS1RIS said "you guys depends on tools alot" hehe.



Note: **ALWAYS** run malware analysis inside controlled environment. In this case, you may use virtualbox or vmware.



zip password: infected



### 0 - NoBu.obb

> **Description**
> 
> what is the md5 of this *NoBu.obb* file?

Simple task, it asked for md5 so all we have to do is get the md5 hash.



I'll show 3 ways of obtaining md5:

#### 1. Using Windows

Simply run this command inside your `powershell`:

```bash
Get-FileHash -Algorithm MD5 NoBu.obb
```



#### 2. Using Linux

If you are running kali linux (or any linux), run this:

```bash
md5sum NoBu.obb
```

#### 3. Using Virustotal

insert file into virustotal > details > read md5



---

### 1 - Filetype

> **Description**
> 
> extract the drop file. what is the file type of the file that have already extracted?



okay so basically, we have to read the malicious file and figure what file it actually is (it is not .obb file since it is obfuscated).



If you are using windows, simply right click and choose "edit in notepad" to read it using notepad.



After analysing, we can see this part:

```bash
# Write zip to file
$UtLwokbeYBmzFoFJ = "temp" + (Get-Random -Minimum 1000 -Maximum 9999).ToString() + ".zip"
$QIkxDAvg = "$env:AppData\$UtLwokbeYBmzFoFJ"
[System.IO.File]::WriteAllBytes($QIkxDAvg, $cdTlOkTcE)
```

This part shows that this file simple converted into `zip`

---

### 2 - Extraction

> **Description**
> 
> extract the drop file and whats the hash? (in md5)

This part is kinda tricky because we need to extract the file inside the NoBu.obb and we cant simply rename it into .zip and extract it because it is now obfuscated. So, we need to decrypt it and get the file!



From NoBu.obb:

```c
function iBhrFCSRB {
# Embedded data decryption
$OpEYknUQeKtuOvYO = "5xTK9HCPrbLHtHKnhoUTy1aKGQ/x8DX53c9K64dEI1E="
$GqTtNpXWIc = "Yd8Pupt4L/vjrfixEsO0RQ=="
$ZYbvKLutjvBj = "S0EN+
```

below this part, there should be a very long obfuscated text. That long text is the "file" we need to extract. Now lets find out how to decrypt it first!



From NoBu.obb:

```c
# Convert from base64
$fFvOuAfHIeqN = [System.Convert]::FromBase64String($OpEYknUQeKtuOvYO)
$LCDsdZltfsZVs = [System.Convert]::FromBase64String($GqTtNpXWIc)
$HKBnkHHcBzOJWLk = [System.Convert]::FromBase64String($ZYbvKLutjvBj)

# Create AES decryptor
$RCklKqNWj = [System.Security.Cryptography.Aes]::Create()
$RCklKqNWj.Key = $fFvOuAfHIeqN
$RCklKqNWj.IV = $LCDsdZltfsZVs
$RCklKqNWj.Mode = [System.Security.Cryptography.CipherMode]::CBC
$RCklKqNWj.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
```

After analysing some more, we can read the comments made that this long obfuscated text is encrypted by base64 and AES decryptor. Now we need to find what is the IV and key for the AES encryption. If you dont know what is AES, click [here]([Advanced Encryption Standard (AES) - GeeksforGeeks](https://www.geeksforgeeks.org/computer-networks/advanced-encryption-standard-aes/)).



We can find the key and IV just by referring these part:

```c
$RCklKqNWj.Key = $fFvOuAfHIeqN
$RCklKqNWj.IV = $LCDsdZltfsZVs
```

then:

```c
$fFvOuAfHIeqN = [System.Convert]::FromBase64String($OpEYknUQeKtuOvYO)
$LCDsdZltfsZVs = [System.Convert]::FromBase64String($GqTtNpXWIc)
```

and:

```c
$OpEYknUQeKtuOvYO = "5xTK9HCPrbLHtHKnhoUTy1aKGQ/x8DX53c9K64dEI1E="
$GqTtNpXWIc = "Yd8Pupt4L/vjrfixEsO0RQ=="
```

After referring using ctrl+F (inside notepad), we got the key and iv!



Now simply just [cyberchef]([CyberChef](https://gchq.github.io/CyberChef/#input=ZTAxMmQwYTFmZmZhYzQyZDZhYWUwMGM1NDA3OGFkM2U)) to decrypt.  Just put together everything we have found!






